<!-- app/views/forms/new.html.erb -->
<!DOCTYPE html>
<html>
<head>
  <title>FormApp</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tag %>
</head>



<section>


  <h2>User's Forms</h2>

    <%= render "layouts/navbar" %>

  <% @forms = Form.find_all_by_owner_id(current_user.id)%>
<div class='display_field group'>
  <% @forms.each do |form| %>
  <div class='display-row'>



  <div class='right-display-column'>

       <%= link_to "Edit This Form",  edit_form_path(form.id), :class => "button" %>
       <%= button_to("Delete this form", form_url(form.id),  method: "delete", data: { confirm: 'Are you sure?' }) %>

    <h2>The rendered form</h2>
    <h3><%=form.form_name%></h3>

          <ul>

            <%= generate_header(form).html_safe%>
            <br>
              <% form.entries.each do |entry| %>

              <li>

                <% @label = entry.as_json["label"] %>
                <%= @label %>
                <br>
                Instructions for <%= @label || "this entry" %>: <%=  entry.as_json["instructions"]  %>
                <% @form_hash  = entry.as_json.reject {|k,v| v==nil}.reject{|k,v| k=="created_at" || k=="updated_at" || k=="instructions" } %>

                <br>

                <%= form_gen(@form_hash).html_safe%>

              </li>

              <% end %>

            </ul>

            <br>
              </div>
            <div class='left-display-column'>
            <h2>The code!</h2>
              <div>
              <section class='code-label'>
                  <br>
              <%= form.header_text%>
              </section>
              <br>
              <section class='code-label'>

                <% @coder = HTMLEntities.new %>

                <%= @coder.decode("<ul class='export-style-color-ul export-style-layout-ul'>") %>


              <% form.entries.each do |entry| %>

              <br>

              <% @form_hash  = entry.as_json.reject {|k,v| v==nil}.reject{|k,v| k=="created_at" || k=="updated_at" || k=="instructions" } %>


              <br>
              <%= @coder.decode("<li class='export-style-color-li export-style-layout-li'>") %>
              <%= @coder.decode(form_gen(@form_hash))%>
              <%= @coder.decode('</li>') %>
              <br>

              <% end %>

              <%= @coder.decode('</ul>') %>
              </section>
              <br>
              <section class='code-label'><br>
              <%= form.closing_text%>
              </section>
              </div>
              </div>
            </div>


          <% end %>

        </div>


</section>

</html>